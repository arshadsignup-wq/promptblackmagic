<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Black Magic</title>
  <meta name="theme-color" content="#08060f">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#10038;</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="prompts.js"></script>
</head>
<body>

  <!-- Ambient floating orbs -->
  <div class="ambient-bg" aria-hidden="true">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <!-- ─── DETAIL PAGE ─── -->
  <div class="detail-page" id="detail-page">
    <!-- Rendered by JS -->
  </div>

  <script>
  (function() {
    'use strict';

    const params = new URLSearchParams(window.location.search);
    const page = document.getElementById('detail-page');

    // Resolve prompt by slug or legacy id
    let id;
    const slugParam = params.get('prompt');
    const idParam = params.get('id');

    if (slugParam && PROMPTS_SLUG_INDEX.hasOwnProperty(slugParam)) {
      id = PROMPTS_SLUG_INDEX[slugParam];
    } else if (idParam !== null) {
      id = parseInt(idParam, 10);
    }

    if (id === undefined || isNaN(id) || id < 0 || id >= PROMPTS_DATA.length) {
      page.innerHTML = '<div class="detail-card" style="margin-top:60px"><p class="detail-error">Prompt not found.</p></div>';
      return;
    }

    const p = PROMPTS_DATA[id];
    document.title = p.title + ' | Prompt Black Magic';

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Icons
    const icons = {
      copy: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>',
      check: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
      back: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>',
      method: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>',
      code: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>',
      prev: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>',
      next: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 6 15 12 9 18"/></svg>',
      sparkle: '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>'
    };

    // Navigation
    const prevId = id > 0 ? id - 1 : null;
    const nextId = id < PROMPTS_DATA.length - 1 ? id + 1 : null;

    const prevLink = prevId !== null
      ? `<a href="prompt.html?prompt=${PROMPTS_DATA[prevId]._slug}" class="detail-nav-btn">${icons.prev}<span>${escapeHtml(PROMPTS_DATA[prevId].title)}</span></a>`
      : '<span></span>';
    const nextLink = nextId !== null
      ? `<a href="prompt.html?prompt=${PROMPTS_DATA[nextId]._slug}" class="detail-nav-btn detail-nav-next"><span>${escapeHtml(PROMPTS_DATA[nextId].title)}</span>${icons.next}</a>`
      : '<span></span>';

    page.innerHTML = `
      <!-- Top bar -->
      <nav class="detail-topbar">
        <a href="index.html" class="back-link">${icons.back} All Prompts</a>
        <span class="detail-prompt-number">${id + 1} / ${PROMPTS_DATA.length}</span>
      </nav>

      <!-- Hero banner -->
      <div class="detail-hero">
        <div class="detail-hero-glow"></div>
        <span class="detail-category">${escapeHtml(p.category)}</span>
        <h1 class="detail-title">${escapeHtml(p.title)}</h1>
        <p class="detail-description">${escapeHtml(p.description)}</p>
      </div>

      <!-- How to use -->
      <div class="detail-section detail-section-method">
        <div class="detail-section-label">
          <span class="detail-section-icon">${icons.method}</span>
          <h2>How to Use</h2>
        </div>
        <div class="detail-method-content">
          <p>${escapeHtml(p.method)}</p>
        </div>
      </div>

      <!-- The Prompt -->
      <div class="detail-section detail-section-prompt">
        <div class="detail-section-label">
          <span class="detail-section-icon">${icons.code}</span>
          <h2>The Prompt</h2>
          <button class="copy-btn detail-copy-inline" id="copy-inline">
            <span class="btn-text"><span class="icon">${icons.copy}</span> Copy</span>
          </button>
        </div>
        <div class="detail-prompt-wrapper">
          <pre class="detail-prompt">${escapeHtml(p.prompt)}</pre>
        </div>
      </div>

      <!-- Big copy CTA -->
      <button class="copy-btn detail-copy-cta" id="copy-cta">
        <span class="btn-text"><span class="icon">${icons.copy}</span> Copy This Prompt</span>
      </button>

      <!-- Prompt navigation -->
      <div class="detail-nav-footer">
        ${prevLink}
        ${nextLink}
      </div>
    `;

    // Copy handlers
    let timeout;
    function handleCopy(btn) {
      navigator.clipboard.writeText(p.prompt).then(() => {
        btn.classList.add('copied');
        btn.querySelector('.btn-text').innerHTML = '<span class="icon">' + icons.check + '</span> Copied!';
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          btn.classList.remove('copied');
          const label = btn.id === 'copy-inline' ? 'Copy' : 'Copy This Prompt';
          btn.querySelector('.btn-text').innerHTML = '<span class="icon">' + icons.copy + '</span> ' + label;
        }, 2500);
      });
    }

    document.getElementById('copy-inline').addEventListener('click', function() { handleCopy(this); });
    document.getElementById('copy-cta').addEventListener('click', function() { handleCopy(this); });
  })();
  </script>

</body>
</html>
